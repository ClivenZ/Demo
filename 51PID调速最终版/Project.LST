C51 COMPILER V9.00   PROJECT                                                               05/17/2019 16:07:40 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE PROJECT
OBJECT MODULE PLACED IN Project.OBJ
COMPILER INVOKED BY: E:\keil4\C51\BIN\C51.EXE Project.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /**********************BST-M51实验开发板例程************************
   2          *  平台：BST-M51 + Keil U4 + STC89C52
   3          *  名称： 
   4          *  公司：深圳市亚博软件开发有限公司                                               
   5          *  日期：2015-6
   6          *  晶振:11.0592MHZ
   7          *  说明：免费开源，不提供源代码分析.
   8          ******************************************************************/
   9          /*******************************************************************/
  10          /*                                                                 */
  11          /* 单片机开发系统演示程序 - 128*64LCD显示显示  */
  12          /*                                                                 */
  13          //;*  LCD型号：TS12864A-3（带汉字库）或兼容型号    控制器ST7920      */
  14          //;*  MCU:AT89S52 ,晶体频率：11.0592MHz                              */
  15          /*                                                                 */
  16          /*******************************************************************/
  17          
  18          #include <reg52.h>
  19          #include <intrins.h>
  20                  
  21          #define uchar unsigned char
  22          #define uint  unsigned int
  23          /*12864端口定义*/
  24          #define LCD_data  P2             //数据口
  25          sbit LCD_RS  =  P0^7;            //寄存器选择输入 
  26          sbit LCD_RW  =  P0^6;            //液晶读/写控制
  27          sbit LCD_EN  =  P0^5;            //液晶使能控制
  28          sbit LCD_PSB =  P0^4;            //串/并方式控制
  29          sbit wela    =  P2^6;
  30          sbit dula    =  P2^7;
  31          sbit di                  =  P3^3;
  32          
  33          uchar code dis1[] = {"亚博智能科技"};
  34          uchar code dis2[] = {"感谢您的选择"};
  35          uchar code dis3[] = {"BST-M51 学习板"};
  36          uchar code dis4[] = {"学习51从这里开始"};
  37          
  38          #define delayNOP(); {_nop_();_nop_();_nop_();_nop_();};
  39          uchar IRDIS[2];
  40          uchar IRCOM[4];
  41          void delay0(uchar x);  //x*0.14MS
  42          void beep();
  43          void  dataconv();
  44          void lcd_pos(uchar X,uchar Y);  //确定显示位置
  45          /*******************************************************************/
  46          /*                                                                 */
  47          /*  延时函数                                                       */
  48          /*                                                                 */
  49          /*******************************************************************/
  50          void delay(int ms)
  51          {
  52   1          while(ms--)
  53   1              {
  54   2            uchar i;
  55   2                for(i=0;i<250;i++)  
C51 COMPILER V9.00   PROJECT                                                               05/17/2019 16:07:40 PAGE 2   

  56   2                 {
  57   3                  _nop_();                       
  58   3                      _nop_();
  59   3                      _nop_();
  60   3                      _nop_();
  61   3                 }
  62   2              }
  63   1      }               
  64          /*******************************************************************/
  65          /*                                                                 */
  66          /*检查LCD忙状态                                                    */
  67          /*lcd_busy为1时，忙，等待。lcd-busy为0时,闲，可写指令与数据。      */
  68          /*                                                                 */
  69          /*******************************************************************/
  70          bit lcd_busy()
  71           {                          
  72   1          bit result;
  73   1          LCD_RS = 0;
  74   1          LCD_RW = 1;
  75   1          LCD_EN = 1;
  76   1          delayNOP();
  77   1          result = (bit)(P0&0x80);
  78   1          LCD_EN = 0;
  79   1          return(result); 
  80   1       }
  81          /*******************************************************************/
  82          /*                                                                 */
  83          /*写指令数据到LCD                                                  */
  84          /*RS=L，RW=L，E=高脉冲，D0-D7=指令码。                             */
  85          /*                                                                 */
  86          /*******************************************************************/
  87          void lcd_wcmd(uchar cmd)
  88          {                          
  89   1         while(lcd_busy());
  90   1          LCD_RS = 0;
  91   1          LCD_RW = 0;
  92   1          LCD_EN = 0;
  93   1          _nop_();
  94   1          _nop_(); 
  95   1          P0 = cmd;
  96   1          delayNOP();
  97   1          LCD_EN = 1;
  98   1          delayNOP();
  99   1          LCD_EN = 0;  
 100   1      }
 101          /*******************************************************************/
 102          /*                                                                 */
 103          /*写显示数据到LCD                                                  */
 104          /*RS=H，RW=L，E=高脉冲，D0-D7=数据。                               */
 105          /*                                                                 */
 106          /*******************************************************************/
 107          void lcd_wdat(uchar dat)
 108          {                          
 109   1         while(lcd_busy());
 110   1          LCD_RS = 1;
 111   1          LCD_RW = 0;
 112   1          LCD_EN = 0;
 113   1          P0 = dat;
 114   1          delayNOP();
 115   1          LCD_EN = 1;
 116   1          delayNOP();
 117   1          LCD_EN = 0; 
C51 COMPILER V9.00   PROJECT                                                               05/17/2019 16:07:40 PAGE 3   

 118   1      }
 119          /*******************************************************************/
 120          /*                                                                 */
 121          /*  LCD初始化设定                                                  */
 122          /*                                                                 */
 123          /*******************************************************************/
 124          void lcd_init()
 125          { 
 126   1      
 127   1          LCD_PSB = 1;         //并口方式
 128   1          
 129   1          lcd_wcmd(0x34);      //扩充指令操作
 130   1          delay(5);
 131   1          lcd_wcmd(0x30);      //基本指令操作
 132   1          delay(5);
 133   1          lcd_wcmd(0x0C);      //显示开，关光标
 134   1          delay(5);
 135   1          lcd_wcmd(0x01);      //清除LCD的显示内容
 136   1          delay(5);
 137   1      }
 138          /*********************************************************/
 139          /*                                                                                                               */
 140          /* 主程序                                                                                */
 141          /*                                                       */
 142          /*********************************************************/
 143            main()
 144           {
 145   1          uchar i;
 146   1          delay(10);                 //延时
 147   1          wela=0;
 148   1              dula=0; 
 149   1              di=1;
 150   1          lcd_init();                //初始化LCD             
 151   1        
 152   1          lcd_pos(0,0);             //设置显示位置为第一行的第1个字符
 153   1           i = 0;
 154   1          while(dis1[i] != '\0')
 155   1           {                         //显示字符
 156   2             lcd_wdat(dis1[i]);
 157   2             i++;
 158   2           }
 159   1          lcd_pos(1,0);             //设置显示位置为第二行的第1个字符
 160   1           i = 0;
 161   1          while(dis2[i] != '\0')
 162   1           {
 163   2             lcd_wdat(dis2[i]);      //显示字符
 164   2             i++;
 165   2           }
 166   1               lcd_pos(2,0);             //设置显示位置为第三行的第1个字符
 167   1           i = 0;
 168   1          while(dis3[i] != '\0')
 169   1           {
 170   2             lcd_wdat(dis3[i]);      //显示字符
 171   2             i++;
 172   2           }
 173   1               lcd_pos(3,0);             //设置显示位置为第四行的第1个字符
 174   1           i = 0;
 175   1          while(dis4[i] != '\0')
 176   1           {
 177   2             lcd_wdat(dis4[i]);      //显示字符
 178   2             i++;
 179   2           }
C51 COMPILER V9.00   PROJECT                                                               05/17/2019 16:07:40 PAGE 4   

 180   1           while(1);
 181   1      }
 182          
 183          
 184          
 185          /*********************************************************/
 186          /*                                                                                                               */
 187          /* 延时x*0.14ms子程序                                                                    */
 188          /*                                                       */
 189          /*********************************************************/
 190          
 191          void delay0(uchar x)    //x*0.14MS
 192          {
 193   1        uchar i;
 194   1        while(x--)
 195   1       {
 196   2        for (i = 0; i<13; i++) {}
 197   2       }
 198   1      }
 199          /*********************************************************/
 200          /*                                                       */
 201          /* 设定显示位置                                          */
 202          /*                                                       */
 203          /*********************************************************/
 204          void lcd_pos(uchar X,uchar Y)
 205          {                          
 206   1         uchar  pos;
 207   1         if (X==0)
 208   1           {X=0x80;}
 209   1         else if (X==1)
 210   1           {X=0x90;}
 211   1         else if (X==2)
 212   1           {X=0x88;}
 213   1         else if (X==3)
 214   1           {X=0x98;}
 215   1         pos = X+Y ;  
 216   1         lcd_wcmd(pos);     //显示地址
 217   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    304    ----
   CONSTANT SIZE    =     58    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
